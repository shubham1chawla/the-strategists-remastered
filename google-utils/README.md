# The Strategists - Google Utilities

This directory contains all the source files required to run the Google API-based utilities. These Utilities include -
1. Exporting Google Sheets-based Permissions
2. Downloading game data available on Google Drive
3. Uploading new data generated by the game on Google Drive

## Setup
- Make sure you have `poetry` installed on your system. If not, use the `pip install poetry` command.
- (Optional) Configure `poetry` to create virtual environments inside the project directory by executing `poetry config virtualenvs.in-project true` command.
- Install dependencies by executing the `poetry install` command.
- Use the `poetry shell` command to enter the virtual environment.

## Note
- To export permissions, the service account's email should have at least _Viewer_ permission on the Google Spreadsheet.
- The service account's email should have at least _Viewer_ permission on Google Drive's download folder to download game data.
- The service account's email should have at least _Editor_ permission on Google Drive's upload folder to upload game data.
- By default, the download strategy is set to _missing_, meaning the utility will only download missing CSV files. Use the `--strategy overwrite` flag if you wish to overwrite already downloaded files.
- The script will only upload files not in either download or upload folders.

> [!IMPORTANT]
> Have a look at the sample `permissions.json` file below.
>
>         [
>                 {
>                         "email": "username@email.com",
>                         "gameCreationPermissionStatus": "ENABLED"
>                 },
>                 {
>                         "email": "awesome@other.com",
>                         "gameCreationPermissionStatus": "DISABLED"
>                 }
>         ]
>
> To create this JSON, the Google Spreadsheet range must look like `<SHEET_NAME>!A2:B`, meaning that the query will start from the second row (assuming there is a header). The `A-B` constraint ensures that we require two columns only.
>
> Your Google Spreadsheet should look something like this -
> Email | Create
> --- | ---
> username@email.com | ENABLED
> awesome@other.com | DISABLED

## Commands
- Export `permissions.json` from Google Sheets using the following sample command.

        ./main.py permissions \
        --credentials-json <PATH TO SERVICE ACCOUNT'S CREDENTIALS FILE> \
        --spreadsheet-id <GOOGLE SHEETS' SHEET ID> \
        --spreadsheet-range <SPREADSHEET RANGE> \
        --export-dir <PATH TO EXPORT DIRECTORY>

- Use the following sample command to download game data from Google Drive.

        ./main.py predictions download \
        --credentials-json <PATH TO SERVICE ACCOUNT'S CREDENTIALS FILE> \
        --download-folder-id <GOOGLE DRIVE DOWNLOAD FOLDER ID> \
        --game-data-dir <PATH TO DATA DIRECTORY> \
        --strategy {missing,overwrite}

- Use the following sample command to upload game data to Google Drive.

        ./main.py predictions upload \
        --credentials-json <PATH TO SERVICE ACCOUNT'S CREDENTIALS FILE> \
        --download-folder-id <GOOGLE DRIVE DOWNLOAD FOLDER ID> \
        --upload-folder-id <GOOGLE DRIVE UPLOAD FOLDER ID> \
        --game-data-dir <PATH TO DATA DIRECTORY>

## Reference
- [Google Drive API Python Client Documentation](https://developers.google.com/drive/api/guides/about-sdk)
- [Google Sheets API Python Quickstart](https://developers.google.com/sheets/api/quickstart/python)
